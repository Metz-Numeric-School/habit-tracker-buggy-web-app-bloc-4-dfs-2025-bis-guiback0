# Procédure de Déploiement

Décrivez ci-dessous votre procédure de déploiement en détaillant chacune des étapes. De la préparation du VPS à la méthodologie de déploiement continu.

## Préparation du VPS

Todo...

## Méthode de déploiement

Todo...

En local (MacOS):

- Premier test avec sudo php bin/serve
- Lancement de l'application
- Problème autoloader
- Passer la commande composer install --optimize-autoloader
- Lancement de l'application
- Problème de migration car j'étais en 8.4 et l'apllication est en 8.3
- brew unlink php@8.4
- brew link php@8.3
- L'application se lance correctement
- Changement du DB_HOST sur 127.0.0.1
- Création de la base de donnée :  php bin/create-database
- Base et tables créées avec succès !
- Changement du .env (intégration du vendor)
- git init
- git branch -M main
- git add . (sauf CHANGELOG.md)
- git commit -m "first commit"
- git add . (sauf CHANGELOG.md)
- git commit -m "fix:php autoloader and version"
- git cliff --bump -o CHANGELOG.md
- git add CHANGELOG.md
- git commit -m "new changelog"




Sur la VM :

- Installation de aapanel sur la VM
- URL=https://www.aapanel.com/script/install_7.0_en.sh && if [ -f /usr/bin/curl ];then curl -ksSO "$URL" ;else wget --no-check-certificate -O install_7.0_en.sh "$URL";fi;bash install_7.0_en.sh aapanel
- Congratulations! Installed successfully!
- Création du dossier depot_git dans le /var
- Dans le depot_git, initialisation de git 'git init --bare'

En Local :

- Ajout du remote vps
- git remote add vps root@172.17.4.42:/var/depot_git 
- git push -u vps main
- Changement de tag au 1.0.0
- git push vps tag 1.0.0 

Sur aapanel :

- Connection a aapanel sur https://172.17.4.42:12526
- Cela fonctionne
- installation du package LMNP
- Création du website
- nom de domaine : 172.17.4.42:85
ATTENTION LE SITE SE LANCE SUR LE PRT 85
IMPOSSIBLE DE LE LANCER AILLEURS
- repertoire du site
- /www/wwwroot/zimmer-dfsgr2
- Run de repertoir /public
- Executer Composer



Sur la VM :

- Création de l'arbre de travail
- git --work-tree=/www/wwwroot/zimmer-dfsgr2 --git-dir=/var/depot_git checkout -f 1.0.0

Sur aapanel :

- Création de la base de donnée
- Changement du .env


Le site est déployé ! mais encore beaucoup de problème